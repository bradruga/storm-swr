
REM RAINFALL INTENSITY EDITOR
'-----------------------------------------------------------------------------'

INTENSITYEDITOR:
INTENSITYMENU:
  GOSUB HEADING
  GOSUB INTENSITYEDITHEADING
  LOCATE 8,19:PRINT FN BOX$(41,8)
  LOCATE 9,21:PRINT "ENTER DESIRED FUNCTION"
  LOCATE 11,23:PRINT "1) CREATE INTENSITY DATA FILE"
  LOCATE 12,23:PRINT "2) EDIT EXISTING INTENSITY DATA FILE"
  LOCATE 13,23:PRINT "3) EXIT INTENSITY DATA EDITOR"
  LOCATE 15,21:PRINT "NUMBER?"
  INTENSITYEDITENTER:
    LOCATE 15,29:Y1$="2":CALL PROM(Y1$,1,1)
    IF Y1$ = "1" THEN GOTO INTENSITYCREATE
    IF Y1$ = "2" THEN GOTO INTENSITYEDIT
    IF Y1$ = "3" THEN GOTO INTENSITYEXITROUTINE
  GOTO INTENSITYEDITENTER

INTENSITYEDITHEADING:
  COLOR 15,0
  LOCATE 2,24:PRINT "RAINFALL INTENSITY DATA EDITOR"
  COLOR 7,0
RETURN

INTENSITYINFOLINE:
  INFOLINEERROR%=0
  LOCATE 3,18:PRINT "ENTER NAME OF INTENSITY FILE: ";:CALL PROM(FF$,12,1)
  IF FF$="            " THEN
    INFOLINEERROR%=1
  END IF
RETURN

INTENSITYCREATE:
  GOSUB HEADING
  GOSUB INTENSITYEDITHEADING
  GOSUB INTENSITYINFOLINE
  IF INFOLINEERROR%=1 THEN GOTO INTENSITYMENU
  GOSUB INPUTRECURRANCEINTERVALS
  IF RECERROR%=1 THEN GOTO INTENSITYMENU
  GOSUB PRINTRECURRANCEINTERVALS
  K%=1
  FOR I%=1 TO 50
    INTENSITYLABEL1:
		LOCATE K%+6,2
		MIN1$(I%) = " "
		CALL PROM(MIN1$(I%),4,1)
    IF MIN1$(I%)="    " THEN GOTO INTENSITYLABEL1
    FOR J%=1 TO RECNUM%
      INTENSITYLABEL2:
      LOCATE K%+6,1+10*J%:INTEN$(I%,J%) = " ":CALL PROM(INTEN$(I%,J%),5,1)
      IF INTEN$(I%,J%)="     " THEN GOTO INTENSITYLABEL2
    NEXT J%
  INTENSITYMOREDATA:
  LOCATE 22,5:PRINT"ENTER MORE DATA? ";:Y1$="Y":CALL PROM(Y1$,1,1)
    IF Y1$="N" THEN GOTO INTENSITYENDCREATE
    IF Y1$="Y" THEN GOTO INTENSITYCONTCREATE
    GOTO INTENSITYMOREDATA
  INTENSITYCONTCREATE:
    IF K%=13 THEN
      K%=0
      GOSUB HEADING
      GOSUB INTENSITYEDITHEADING
      GOSUB PRINTRECURRANCEINTERVALS
    END IF
    INCR K%
  NEXT I%
INTENSITYENDCREATE:
  OPEN FF$ FOR OUTPUT AS #1
    WRITE #1, I%,RECNUM%
    FOR I1%=1 TO RECNUM%
      WRITE #1, REC$(I1%)
    NEXT I1%
    FOR I1% = 1 TO I%
      WRITE #1, MIN1$(I1%)
      FOR J%=1 TO RECNUM%
        WRITE #1, INTEN$(I1%,J%)
      NEXT J%
    NEXT I1%
  CLOSE #1
GOTO INTENSITYMENU

INPUTRECURRANCEINTERVALS:
  RECERROR=0
  LOCATE 5,22: PRINT"ENTER RECURRANCE INTERVALS (YEARS)"
  LOCATE 6,34: PRINT"(N-EXITS)"
  FOR I%=1 TO 7
    LOCATE 7+I%,35:PRINT I%:LOCATE 7+I%,37:PRINT "."
    RECFLAG1:
    LOCATE 7+I%,39:CALL PROM(REC$(I%),3,1)
    IF REC$(I%)="   " THEN GOTO RECFLAG1
    IF REC$(I%)="N  " THEN EXIT FOR
  NEXT I%
  IF I%>7 THEN I%=7
  RECNUM%=I%
  IF REC$(I%)="N  " THEN RECNUM%=I%-1
  IF RECNUM%=0 THEN
    RECERROR%=1
    RETURN
  END IF
  GOSUB HEADING
  GOSUB INTENSITYEDITHEADING
  LOCATE 3,18:PRINT "ENTER NAME OF INTENSITY FILE: ";FF$
RETURN

PRINTRECURRANCEINTERVALS:
  LOCATE 5,2:PRINT "MIN"
  FOR J%=1 TO RECNUM%
    LOCATE 5,10*J%:PRINT VAL(REC$(J%));"YR"
  NEXT J%
RETURN



INTENSITYEDIT:
  GOSUB HEADING
  GOSUB INTENSITYEDITHEADING
  IF FF$=CHT$(0) THEN FF$="NJDEP.INT"
  GOSUB INTENSITYINFOLINE
  IF INFOLINEERROR%=1 THEN GOTO INTENSITYMENU
  ON ERROR GOTO INTENSITYINPUTERROR
  OPEN FF$ FOR INPUT AS #1
    INPUT #1, I2%,RECNUM%
    FOR I1%=1 TO RECNUM%
      INPUT #1, REC$(I1%)
    NEXT I1%
    FOR I1% = 1 TO I2%
      INPUT #1, MIN1$(I1%)
      FOR J%=1 TO RECNUM%
        INPUT #1, INTEN$(I1%,J%)
      NEXT J%
    NEXT I1%
  CLOSE #1
  I1%=1
  ON ERROR GOTO 0
  GOSUB PRINTRECURRANCEINTERVALS
  I3%=12:IF I2%<I3% THEN I3%=I2%      'I3% IS MAXIMUM VALUE FOR SCREEN
  FOR I%=1 TO I3%+1
    LOCATE I%+6,2:PRINT MIN1$(I%)
    FOR J%=1 TO RECNUM%
      LOCATE I%+6,1+10*J%:PRINT INTEN$(I%,J%)
    NEXT J%
  NEXT I%
INTENSITYOPTIONSMENU:
  COLOR 15
  LOCATE 21,2:PRINT"F1 - NEXT      F2 - PREVIOUS      F3 - EDIT      F4 - APPEND      F5 - EXIT"
  LOCATE 22,2:PRINT"        F6 - EDIT YEAR      F7 - APPEND YEAR      F8 - DELETE YEAR"
  COLOR 7
  INTENSITYEDITENTER1:
    D1$ = INKEY$
    IF (LEN(D1$)) <> 2 THEN INTENSITYEDITENTER1
    IF D1$ = CHR$(0)+CHR$(61) THEN GOTO INTENSITYEDIT1
    IF D1$ = CHR$(0)+CHR$(59) THEN GOTO INTENSITYNEXT1
    IF D1$ = CHR$(0)+CHR$(60) THEN GOTO INTENSITYPREVIOUS
    IF D1$ = CHR$(0)+CHR$(62) THEN GOTO INTENSITYADDVALUE
    IF D1$ = CHR$(0)+CHR$(63) THEN GOTO INTENSITYEXIT1
    IF D1$ = CHR$(0)+CHR$(64) THEN GOTO INTENSITYEDITYEAR
    IF D1$ = CHR$(0)+CHR$(65) THEN GOTO INTENSITYAPPENDYEAR
    IF D1$ = CHR$(0)+CHR$(66) THEN GOTO INTENSITYDELETEYEAR
  GOTO INTENSITYEDITENTER1

INTENSITYINPUTERROR:
  LOCATE 10,5:COLOR 15:PRINT "FILE DOES NOT EXIST - REENTER!"
  DELAY 3:COLOR 7:LOCATE 10,5:PRINT "                               "
RESUME INTENSITYEDIT

INTENSITYEDIT1:
  LOCATE 21,2:PRINT"                                                                           "
  LOCATE 22,2:PRINT"                                                                           "
  I9%=I1%+I3%:IF I9%>I2% THEN I9%=I2%
  FOR I%=I1% TO I9%
    INTENSITYEDIT1LABEL1:
    LOCATE I%-I1%+7,2:CALL PROM(MIN1$(I%),4,1)
    IF MIN1$(I%)="    " THEN GOTO INTENSITYEDIT1LABEL1
    FOR J%=1 TO RECNUM%
      INTENSITYEDITLABEL2:
      LOCATE I%-I1%+7,10*J%+1:CALL PROM(INTEN$(I%,J%),5,1)
      IF INTEN$(I%,J%)="     " THEN GOTO INTENSITYEDITLABEL2
    NEXT J%
  NEXT I%
GOTO INTENSITYOPTIONSMENU

INTENSITYNEXT1:
  I1%=I1%+13
  IF I1%>I2% THEN
    I1%=I1%-13
    GOTO INTENSITYOPTIONSMENU
  END IF
  I3%=12
  IF (I3%+I1%-1) > I2% THEN I3% = I2%-I1%+1
  GOSUB INTENSITYPRINTVALUES1
GOTO INTENSITYEDITENTER1

INTENSITYPREVIOUS:
  IF I1%=1 THEN GOTO INTENSITYOPTIONSMENU
  I1% = I1%-13
  I3%=12
  GOSUB INTENSITYPRINTVALUES1
GOTO INTENSITYEDITENTER1

INTENSITYADDVALUE:
  LOCATE 21,2:PRINT"                                                                           "
  LOCATE 22,2:PRINT"                                                                           "
  I1% = (INT(I2%/13))*13+1
  I3%=13
  IF (I3%+I1%-1) > I2% THEN I3% = I2%-I1%+1
  GOSUB INTENSITYPRINTVALUES1
  INCR I2%
  INCR I3%
  IF (I2%-I1%) > 12 THEN
    I1%=I1%+13
    I3%=1
    GOSUB INTENSITYPRINTVALUES1
  END IF
  INTENSITYADDVALUELABEL1:
  LOCATE I3%+6,2:MIN1$(I2%) = " ":CALL PROM(MIN1$(I2%),4,1)
  IF MIN1$(I2%)="    " THEN GOTO INTENSITYADDVALUELABEL1
  FOR J%=1 TO RECNUM%
    INTENSITYADDVALUELABEL2:
    LOCATE I3%+6,10*J%+1:INTEN$(I2%,J%) = " ":CALL PROM(INTEN$(I2%,J%),5,1)
    IF INTEN$(I2%,J%)="     " THEN GOTO INTENSITYADDVALUELABEL2
  NEXT J%
GOTO INTENSITYOPTIONSMENU

INTENSITYEXIT1:
  GOSUB HEADING
  GOSUB INTENSITYEDITHEADING
	LOCATE 10,5:PRINT "SAVE DATA? ";:Y1$="Y":CALL PROM(Y1$,1,1)
  IF Y1$ <> "Y" THEN GOTO INTENSITYMENU
  OPEN FF$ FOR OUTPUT AS #1
    WRITE #1, I2%,RECNUM%
    FOR I1%=1 TO RECNUM%
      WRITE #1, REC$(I1%)
    NEXT I1%
    FOR I1% = 1 TO I2%
      WRITE #1, MIN1$(I1%)
      FOR J%=1 TO RECNUM%
        WRITE #1, INTEN$(I1%,J%)
      NEXT J%
    NEXT I1%
  CLOSE #1
GOTO INTENSITYMENU

INTENSITYEDITYEAR:
  FOR J%=1 TO RECNUM%
    IF VAL(REC$(J%))>99 THEN
     LOCATE 5,10*J%:PRINT "    "
    END IF
    INTENSITYEDITYEARLABEL1:
    LOCATE 5,10*J%:CALL PROM(REC$(J%),3,1)
    IF REC$(J%)="   " THEN GOTO INTENSITYEDITYEARLABEL1
    LOCATE 5,10*J%:PRINT VAL(REC$(J%));"YR"
  NEXT J%
GOTO INTENSITYOPTIONSMENU

INTENSITYAPPENDYEAR:
  IF RECNUM%=7 THEN GOTO INTENSITYOPTIONSMENU
  RECNUM%=RECNUM%+1
  LOCATE 5,10*RECNUM%:PRINT "    YR"
  INTENSITYAPPENDYEARLABEL1:
  LOCATE 5,10*RECNUM%:CALL PROM(REC$(RECNUM%),3,1)
  IF REC$(RECNUM%)="   " THEN GOTO INTENSITYAPPENDYEARLABEL1
  LOCATE 5,10*RECNUM%:PRINT VAL(REC$(RECNUM%));"YR"
GOTO INTENSITYOPTIONSMENU

INTENSITYDELETEYEAR:
  IF RECNUM%=1 THEN GOTO INTENSITYOPTIONSMENU
  LOCATE 21,2:PRINT"                                                                           "
  LOCATE 22,2:PRINT"                                                                           "
  DELETEYEARLABEL1:
  LOCATE 21,12:PRINT"ENTER YEAR TO BE DELETED: ";:CALL PROM(YR$,3,1)
  FOR J%=1 TO RECNUM%
    IF YR$=REC$(J%) THEN
      K%=J%
      GOTO DELETEYEARLABEL2
    END IF
  NEXT J%
  GOTO DELETEYEARLABEL1
  DELETEYEARLABEL2:
  RECNUM%=RECNUM%-1
  IF RECNUM%=>K% THEN
    FOR J%=K% TO RECNUM%
      REC$(J%)=REC$(J%+1)
      FOR J1%=1 TO I2%
        INTEN$(J1%,J%)=INTEN$(J1%,J%+1)
      NEXT J1%
    NEXT J%
  END IF
  REC$(RECNUM%+1)=""
  FOR J1%=1 TO I2%
    INTEN$(J1%,RECNUM%+1)=""
  NEXT J1%
  INCR RECNUM%
  GOSUB PRINTRECURRANCEINTERVALS
  LOCATE 5,10*RECNUM%:PRINT "        "
  GOSUB INTENSITYPRINTVALUES1
  DECR RECNUM%
GOTO INTENSITYOPTIONSMENU

INTENSITYPRINTVALUES1:
  FOR I% = I1% TO I1%+I3%
    LOCATE I%-I1%+7,2:PRINT MIN1$(I%)
    FOR J% = 1 TO RECNUM%
      IF INTEN$(I%,J%)="" THEN INTEN$(I%,J%)="     "
      LOCATE I%-I1%+7,10*J%+1:PRINT INTEN$(I%,J%)
    NEXT J%
  NEXT I%
  IF I3%<12 THEN
    FOR J% = I3%+1 TO 14
      LOCATE J%+6,2:PRINT "                                                                            "
    NEXT J%
  END IF
RETURN

INTENSITYEXITROUTINE:
RETURN
